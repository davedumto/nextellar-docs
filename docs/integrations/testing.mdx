---
title: Testing (MSW)
description: Testing Stellar integrations with Mock Service Worker
---

# Testing (MSW)

> [!NOTE]
> Mock Service Worker (MSW) is used internally by the Nextellar CLI for testing but is **not included** in generated projects by default.

This guide covers how to add MSW to your Nextellar project for testing Stellar API interactions.

## What is MSW?

[Mock Service Worker](https://mswjs.io/) is an API mocking library that intercepts requests at the network level. This allows you to:

- Test components without real network calls
- Simulate different API responses (success, errors, timeouts)
- Run tests offline
- Avoid rate limiting issues during development

## Adding MSW to Your Project

### 1. Install MSW

```bash
npm install msw --save-dev
```

### 2. Create Mock Handlers

Create `src/mocks/handlers.ts`:

```typescript
import { http, HttpResponse } from 'msw';

// Mock Horizon API responses
export const handlers = [
  // Mock account balance
  http.get(
    'https://horizon-testnet.stellar.org/accounts/:accountId',
    ({ params }) => {
      return HttpResponse.json({
        id: params.accountId,
        account_id: params.accountId,
        balances: [
          {
            balance: '100.0000000',
            asset_type: 'native',
          },
        ],
        sequence: '123456',
      });
    }
  ),

  // Mock transaction submission
  http.post('https://horizon-testnet.stellar.org/transactions', () => {
    return HttpResponse.json({
      hash: 'abc123...',
      ledger: 12345,
      successful: true,
    });
  }),

  // Mock 404 for unfunded account
  http.get('https://horizon-testnet.stellar.org/accounts/GUNFUNDED*', () => {
    return new HttpResponse(null, { status: 404 });
  }),
];
```

### 3. Create Server Setup

Create `src/mocks/server.ts`:

```typescript
import { setupServer } from 'msw/node';
import { handlers } from './handlers';

export const server = setupServer(...handlers);
```

### 4. Configure Jest

Update `jest.setup.ts`:

```typescript
import { server } from './src/mocks/server';

beforeAll(() => server.listen({ onUnhandledRequest: 'error' }));
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

## Example Test

```typescript
import { renderHook, waitFor } from '@testing-library/react';
import { useStellarBalances } from '@/hooks/useStellarBalances';
import { server } from '@/mocks/server';
import { http, HttpResponse } from 'msw';

describe('useStellarBalances', () => {
  it('fetches balances successfully', async () => {
    const { result } = renderHook(() => useStellarBalances('GABC123...'));

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
    });

    expect(result.current.balances).toHaveLength(1);
    expect(result.current.balances[0].balance).toBe('100.0000000');
  });

  it('handles unfunded account', async () => {
    // Override handler for this test
    server.use(
      http.get('https://horizon-testnet.stellar.org/accounts/*', () => {
        return new HttpResponse(null, { status: 404 });
      })
    );

    const { result } = renderHook(() => useStellarBalances('GUNFUNDED...'));

    await waitFor(() => {
      expect(result.current.loading).toBe(false);
    });

    expect(result.current.balances).toHaveLength(0);
  });
});
```

## Mock Soroban RPC

```typescript
// Add to handlers.ts
http.post('https://soroban-testnet.stellar.org', async ({ request }) => {
  const body = await request.json();

  if (body.method === 'simulateTransaction') {
    return HttpResponse.json({
      result: {
        results: [{ xdr: 'AAAA...' }],
        cost: { cpuInsns: '1000', memBytes: '2000' },
      },
    });
  }

  if (body.method === 'sendTransaction') {
    return HttpResponse.json({
      result: {
        status: 'PENDING',
        hash: 'xyz789...',
      },
    });
  }

  return HttpResponse.json({ error: 'Unknown method' });
});
```

## Testing Transaction Signing

For wallet signing, mock the stellar-wallets-kit:

```typescript
// __mocks__/stellar-wallet-kit.ts
export const kit = {
  signTransaction: jest.fn().mockResolvedValue({
    signedTxXdr: 'signed-xdr-string',
  }),
  openModal: jest.fn(),
  getAddress: jest.fn().mockResolvedValue({
    address: 'GABC123...',
  }),
};

export const getKit = () => kit;
```

```typescript
// In your test
jest.mock('@/lib/stellar-wallet-kit');

import { kit } from '@/lib/stellar-wallet-kit';

it('signs transaction with wallet', async () => {
  // Your test code
  expect(kit.signTransaction).toHaveBeenCalledWith(
    expect.any(String),
    expect.objectContaining({ address: expect.any(String) })
  );
});
```

## Browser Testing with MSW

For browser/E2E testing:

```typescript
// src/mocks/browser.ts
import { setupWorker } from 'msw/browser';
import { handlers } from './handlers';

export const worker = setupWorker(...handlers);
```

```typescript
// Start in development
if (process.env.NODE_ENV === 'development') {
  const { worker } = await import('./mocks/browser');
  await worker.start();
}
```

## Related

- [MSW Documentation](https://mswjs.io/docs)
- [Stellar Horizon](/docs/integrations/horizon) - APIs to mock
- [Soroban](/docs/integrations/soroban) - Smart contract testing
