---
title: useTrustlines
description: Manage asset trustlines on Stellar accounts with XDR building and submission
---

# useTrustlines

The `useTrustlines` hook manages asset trustlines, allowing accounts to hold custom Stellar assets. It provides methods to query existing trustlines, build change-trust transactions, and submit them to the network.

## Features

- **Query Trustlines**: Fetch and list all active trustlines for an account
- ï¿½ **Build Change Trust XDR**: Create unsigned transactions for wallet signing
- **Dev-Only Submission**: Sign and submit with secret key (testing only)
- **Authorization Tracking**: Monitor asset authorization status
- **Custom Limits**: Set trust limits on assets
- **Auto-Consume Config**: Automatically uses `WalletProvider` settings as fallback

## Basic Usage

```tsx
import { useTrustlines } from '@/hooks/useTrustlines';

export default function TrustlineManager({ publicKey }: { publicKey: string }) {
  const { trustlines, loading, error, refresh, buildChangeTrustXDR } =
    useTrustlines(publicKey);

  const handleAddUSDC = async () => {
    try {
      // Build unsigned XDR for wallet signing
      const xdr = await buildChangeTrustXDR({
        code: 'USDC',
        issuer: 'GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN',
        limit: '1000000', // Optional: max 1M USDC
      });

      // Pass XDR to your wallet for signing...
      console.log('Sign this XDR:', xdr);
    } catch (err) {
      console.error('Failed to build XDR:', err);
    }
  };

  if (loading) return <div>Loading trustlines...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      <button onClick={handleAddUSDC}>Add USDC Trustline</button>
      <button onClick={refresh}>Refresh</button>

      <h3>Active Trustlines:</h3>
      {trustlines.length === 0 ? (
        <p>No trustlines. Account only holds native XLM.</p>
      ) : (
        trustlines.map((tl, index) => (
          <div key={index}>
            <strong>{tl.asset_code}</strong>
            <span> (Issuer: {tl.asset_issuer.substring(0, 8)}...)</span>
            <span> Balance: {tl.balance || '0'}</span>
            {tl.limit && <span> Limit: {tl.limit}</span>}
          </div>
        ))
      )}
    </div>
  );
}
```

## API Reference

### Parameters

```typescript
useTrustlines(
  publicKey?: string | null,
  options?: {
    horizonUrl?: string;        // Defaults to WalletProvider config or testnet
    network?: 'TESTNET' | 'PUBLIC';
  }
): TrustlinesState
```

### Return Value

```typescript
interface TrustlinesState {
  trustlines: Trustline[];
  loading: boolean;
  error?: Error | null;
  refresh: () => Promise<void>;
  buildChangeTrustXDR: (asset: {
    code: string;
    issuer: string;
    limit?: string;
  }) => Promise<string>;
  submitChangeTrustWithSecret: (
    xdr: string,
    secret: string
  ) => Promise<{ success: boolean; hash?: string; error?: string }>;
}
```

### Trustline Interface

```typescript
interface Trustline {
  asset_code: string;
  asset_issuer: string;
  limit?: string;
  balance?: string;
  authorized?: boolean;
}
```

## Examples

### Build XDR for Wallet Signing

```tsx
const { buildChangeTrustXDR } = useTrustlines(publicKey);

// Create unsigned XDR to add USDC trustline
const xdr = await buildChangeTrustXDR({
  code: 'USDC',
  issuer: 'GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN',
  limit: '1000000',
});

// Sign with Freighter or other wallet
const signedXdr = await freighter.signTransaction(xdr);
```

### Dev-Only: Submit with Secret Key

> [!CAUTION]
> This method is for **development and testing only**. Never use secret keys in production client-side code.

```tsx
const { buildChangeTrustXDR, submitChangeTrustWithSecret } =
  useTrustlines(publicKey);

// Build the XDR
const xdr = await buildChangeTrustXDR({
  code: 'USDC',
  issuer: 'GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN',
});

// DEV ONLY: Sign and submit
const result = await submitChangeTrustWithSecret(xdr, 'SABC123...');

if (result.success) {
  console.log('Transaction hash:', result.hash);
} else {
  console.error('Failed:', result.error);
}
```

### Remove Trustline

To remove a trustline, set the limit to `"0"`:

```tsx
const xdr = await buildChangeTrustXDR({
  code: 'USDC',
  issuer: 'GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN',
  limit: '0', // Setting limit to 0 removes the trustline
});
```

### Check if Trustline Exists

```tsx
const { trustlines } = useTrustlines(publicKey);

const hasUSDC = trustlines.some((tl) => tl.asset_code === 'USDC');
```

## Best Practices

1. **Verify Issuer**: Always verify the asset issuer address before adding a trustline
2. **Set Limits**: Use trust limits to cap your exposure to a particular asset
3. **Remove Unused**: Remove trustlines for assets you no longer use (balance must be 0)
4. **Check Authorization**: Some assets require issuer authorization before you can hold them
5. **Use Wallet Signing**: In production, always use `buildChangeTrustXDR` with external wallet signing

## Using with WalletProvider

The hook automatically consumes configuration from `WalletProvider`:

```tsx
// In your app layout
<WalletProvider horizonUrl="https://horizon.stellar.org" network="PUBLIC">
  <App />
</WalletProvider>;

// In your component - hook uses provider's horizonUrl automatically
function MyComponent() {
  const { trustlines } = useTrustlines(publicKey);
  // Uses mainnet automatically from provider
}
```

Or override per-component:

```tsx
const { trustlines } = useTrustlines(publicKey, {
  horizonUrl: 'https://horizon-testnet.stellar.org',
  network: 'TESTNET',
});
```

## Related Hooks

- [`useStellarBalances`](/docs/hooks/use-stellar-balances) - View asset balances
- [`useStellarPayment`](/docs/hooks/use-stellar-payment) - Send custom assets
- [`useStellarWallet`](/docs/hooks/use-stellar-wallet) - Wallet connection and management
