---
title: useStellarBalances
description: Real-time account balance tracking for XLM and custom assets
---

# useStellarBalances

The `useStellarBalances` hook provides real-time balance tracking for Stellar accounts, including XLM and all custom assets with automatic polling capabilities.

## Features

- **Real-Time Balances**: Automatic balance fetching
- **Polling**: Configurable polling interval for live updates
- **All Assets**: XLM and custom asset support
- **Efficient**: Duplicate request prevention
- **Auto-Consume Config**: Uses WalletProvider settings automatically
- **Graceful Errors**: Handles unfunded accounts (404)

## Basic Usage

```tsx
import { useStellarBalances } from '@/hooks/useStellarBalances';

export default function BalanceDisplay({ publicKey }: { publicKey: string }) {
  const { balances, loading, error, refresh, stopPolling } =
    useStellarBalances(publicKey);

  if (loading && balances.length === 0) return <div>Loading balances...</div>;
  if (error)
    return (
      <div>
        Error: {error.message} <button onClick={refresh}>Retry</button>
      </div>
    );

  return (
    <div>
      {balances.length === 0 ? (
        <p>No balances found. Account may need funding.</p>
      ) : (
        balances.map((balance, index) => (
          <div key={index}>
            {balance.asset_type === 'native' ? 'XLM' : balance.asset_code}:{' '}
            {balance.balance}
          </div>
        ))
      )}
      <button onClick={refresh}>Refresh</button>
    </div>
  );
}
```

## API Reference

### Parameters

```typescript
useStellarBalances(
  publicKey?: string | null,
  options?: {
    horizonUrl?: string;
    pollIntervalMs?: number | null;
  }
): StellarBalancesState
```

| Parameter        | Type             | Default                   | Description                          |
| ---------------- | ---------------- | ------------------------- | ------------------------------------ |
| `publicKey`      | `string \| null` | `undefined`               | Stellar public key to fetch balances |
| `horizonUrl`     | `string`         | WalletProvider or testnet | Horizon server URL                   |
| `pollIntervalMs` | `number \| null` | `null` (no polling)       | Poll interval in ms (min 5000)       |

### Return Value

```typescript
interface StellarBalancesState {
  balances: Balance[];
  loading: boolean;
  error?: Error | null;
  refresh: () => Promise<void>;
  stopPolling: () => void;
}

interface Balance {
  asset_type: string; // 'native' or 'credit_alphanum4', etc.
  asset_code?: string;
  asset_issuer?: string;
  balance: string;
  limit?: string;
}
```

## Examples

### With Polling

```tsx
const { balances, stopPolling } = useStellarBalances(publicKey, {
  pollIntervalMs: 10000, // Poll every 10 seconds
});

// Stop polling when component unmounts or user navigates away
useEffect(() => {
  return () => stopPolling();
}, [stopPolling]);
```

### Filter by Asset Type

```tsx
const { balances } = useStellarBalances(publicKey);

const xlmBalance =
  balances.find((b) => b.asset_type === 'native')?.balance ?? '0';
const customAssets = balances.filter((b) => b.asset_type !== 'native');

return (
  <div>
    <p>XLM: {xlmBalance}</p>
    <h3>Custom Assets:</h3>
    {customAssets.map((asset, i) => (
      <p key={i}>
        {asset.balance} {asset.asset_code}
      </p>
    ))}
  </div>
);
```

### Manual Refresh After Transaction

```tsx
const { refresh } = useStellarBalances(publicKey);
const { sendPayment } = useWallet();

const handleSend = async () => {
  await sendPayment({ to, amount, asset: 'XLM' });
  await refresh(); // Update balances after payment
};
```

### With Custom Horizon URL

```tsx
// Override provider config for this component
const { balances } = useStellarBalances(publicKey, {
  horizonUrl: 'https://horizon.stellar.org', // Use mainnet
});
```

## Auto-Consume Pattern

The hook automatically uses `WalletProvider` config as fallback:

```tsx
// Provider sets config
<WalletProvider horizonUrl="https://horizon.stellar.org">
  <App />
</WalletProvider>;

// Hook uses provider's horizonUrl
function MyComponent() {
  const { balances } = useStellarBalances(publicKey);
  // Uses mainnet automatically!
}
```

## Best Practices

1. **Use Polling Sparingly**: Only enable for critical views (min 5 seconds)
2. **Stop Polling on Unmount**: Call `stopPolling()` in cleanup
3. **Handle Empty Balances**: New accounts return empty until funded
4. **Cache Results**: Consider React Query/SWR for advanced caching

## Related Hooks

- [`useStellarWallet`](/docs/hooks/use-stellar-wallet) - Wallet connection with balances
- [`useTrustlines`](/docs/hooks/use-trustlines) - Manage asset trustlines
- [`WalletProvider`](/docs/hooks/wallet-provider) - Global configuration
